{"version":3,"sources":["../../../src/components/sandbox/sandbox-output.js"],"names":["Observable","ReplaySubject","Subject","VirtualTimeScheduler","assoc","curry","merge","calculateNotificationContentHash","MAX_TIME","toVTStream","_toVTStream","scheduler","data","marbleStreams$","observer","marbles","forEach","item","schedule","next","time","takeUntil","timer","end","outputStreamToMarbles$","stream","subject$","stop$","endTime","observeOn","timestamp","map","value","marble","content","id","reduce","a","b","concat","items","i","itemId","subscribe","undefined","now","flush","asObservable","createOutputStream$","example$","inputStores$","debounceTime","withLatestFrom","inputStores","example","vtScheduler","inputStreams","outputStream","apply","mergeAll","publishReplay","refCount"],"mappings":"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","sourcesContent":["import { Observable, ReplaySubject, Subject, VirtualTimeScheduler } from 'rxjs';\nimport { assoc, curry, merge } from 'ramda';\n\nimport { calculateNotificationContentHash } from './sandbox-utils';\n\nconst MAX_TIME = 100;\n\nconst toVTStream = curry(function _toVTStream(scheduler, data) {\n  const marbleStreams$ = new Observable(observer => {\n    data.marbles.forEach(item =>\n      scheduler.schedule(() => observer.next(item), item.time));\n  });\n  return marbleStreams$\n    .takeUntil(Observable.timer(data.end.time + 1, scheduler));\n});\n\nfunction outputStreamToMarbles$(scheduler, stream) {\n  const subject$ = new ReplaySubject(1);\n  const stop$ = new Subject();\n  let endTime;\n\n  stream\n    .observeOn(scheduler)\n    .timestamp(scheduler)\n    .map(({ value, timestamp }) => {\n      const marble = typeof value !== 'object'\n        ? { content: value, id: calculateNotificationContentHash(value) }\n        : value;\n\n      return assoc('time', timestamp / MAX_TIME * 100, marble);\n    })\n    .takeUntil(stop$)\n    .reduce((a, b) => a.concat(b), [])\n    .map(items => items.map(\n      (item, i) => merge(item, { itemId: i }))\n    )\n    .subscribe(\n      items => subject$.next(items),\n      undefined,\n      () => endTime = scheduler.now(),\n    );\n\n  scheduler.flush();\n  stop$.next();\n\n  return subject$.asObservable()\n    .map(marbles => ({ marbles, end: { time: endTime } }));\n}\n\nexport function createOutputStream$(example$, inputStores$) {\n  return inputStores$.debounceTime(0).withLatestFrom(example$)\n    .map(([inputStores, example]) => {\n      const vtScheduler = new VirtualTimeScheduler(undefined, MAX_TIME);\n\n      const inputStreams = inputStores.map(toVTStream(vtScheduler));\n      const outputStream = example.apply(inputStreams, vtScheduler)\n        // add 0.01 or else things at exactly MAX_TIME will cut off\n        .takeUntil(Observable.timer(MAX_TIME + 0.01, vtScheduler));\n\n      return outputStreamToMarbles$(vtScheduler, outputStream);\n    })\n    .mergeAll()\n    .publishReplay(1).refCount();\n}\n"],"file":"sandbox-output.js"}