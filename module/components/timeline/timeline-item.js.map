{"version":3,"sources":["../../../src/components/timeline/timeline-item.js"],"names":["Observable","add","compose","path","multiply","max","min","mouseMove$","fromEvent","document","mouseUp$","getPercentageFn","element","width","left","getBoundingClientRect","ratio","elementLeft","window","scrollX","x","getPausable$","pause$","obsv$","switchMap","pause","never","intent","elementClass","DOMSource","isDraggable$","select","startHighlight$","events","mapTo","stopHighlight$","isHighlighted$","merge","startWith","publishReplay","refCount","timeChange$","map","getPercentage","takeUntil","pluck","distinctUntilChanged","model","props$","timeSource$","restrictedTimeChange$","minChange$","withLatestFrom","maxChange$","timelineItem","view","sources","DOM","props","time","isDraggable","time$","vtree$"],"mappings":"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","sourcesContent":["import { Observable } from 'rxjs';\nimport { add, compose, path, multiply, max, min } from 'ramda';\n\nconst mouseMove$ = Observable.fromEvent(document, 'mousemove');\nconst mouseUp$ = Observable.fromEvent(document, 'mouseup');\n\nfunction getPercentageFn(element) {\n  const { width, left } = element.getBoundingClientRect();\n  const ratio = (100 / width) || 0.15;\n  const elementLeft = left + window.scrollX;\n  return (x) => (x - elementLeft) * ratio;\n}\n\nfunction getPausable$(pause$, obsv$) {\n  return pause$\n    .switchMap(pause => pause ? obsv$ : Observable.never());\n}\n\nfunction intent(elementClass, DOMSource, isDraggable$) {\n  const element = DOMSource.select('.' + elementClass);\n\n  const startHighlight$ = element.events('mouseenter').mapTo(true);\n  const stopHighlight$ = element.events('mouseleave').mapTo(false);\n  const isHighlighted$ = getPausable$(\n    isDraggable$, Observable.merge(startHighlight$, stopHighlight$))\n    .startWith(false)\n    .publishReplay(1).refCount();\n\n  const timeChange$ = element.events('mousedown')\n    .map(path(['currentTarget', 'parentElement']))\n    .map(getPercentageFn)\n    .switchMap(getPercentage =>\n      mouseMove$.takeUntil(mouseUp$)\n        .pluck('pageX')\n        .map(getPercentage)\n        .distinctUntilChanged()\n    );\n\n  return { timeChange$, isHighlighted$ };\n}\n\nfunction model(props$, timeSource$, timeChange$, isDraggable$) {\n  const restrictedTimeChange$ = getPausable$(isDraggable$, timeChange$)\n    .map(max(0))\n    .map(min(100));\n\n  const minChange$ = props$.pluck('minTime')\n    .distinctUntilChanged()\n    .withLatestFrom(timeSource$, max);\n\n  const maxChange$ = props$.pluck('maxTime')\n    .distinctUntilChanged()\n    .withLatestFrom(timeSource$, min);\n\n  return Observable.merge(\n    // order matters\n    timeSource$, restrictedTimeChange$, minChange$, maxChange$)\n    .distinctUntilChanged()\n    .publishReplay(1).refCount();\n}\n\nexport function timelineItem(elementClass, view, sources) {\n  const { DOM, props, time: timeSource$, isDraggable } = sources;\n  const { timeChange$, isHighlighted$ }\n    = intent(elementClass, DOM, isDraggable);\n  const time$ = model(props, timeSource$, timeChange$, isDraggable);\n  const vtree$ = view(sources, time$, isHighlighted$);\n  return { DOM: vtree$, time: time$ };\n}\n"],"file":"timeline-item.js"}